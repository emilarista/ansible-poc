! Command: show running-config
! device: LEAF1B (vEOS, EOS-4.25.0F)
!
! boot system flash:/vEOS-lab.swi
!
alias asd show ip interface brief
alias qwe interface Management 1
alias sa show active
!
daemon TerminAttr
   exec /usr/bin/TerminAttr -ingestgrpcurl=10.20.20.20:9910 -cvcompression=gzip -ingestauth=key,volvo240 -smashexcludes=ale,flexCounter,hardware,kni,pulse,strata -ingestexclude=/Sysdb/cell/1/agent,/Sysdb/cell/2/agent -ingestvrf=MGMT -taillogs
   no shutdown
!
transceiver qsfp default-mode 4x10G
!
service routing protocols model multi-agent
!
hostname LEAF1B
!
spanning-tree mode mstp
!
aaa authorization commands all default local
!
no aaa root
!
username cvpadmin privilege 15 role network-admin secret sha512 $6$WRH0YV9I461XA.qn$BYsYGThSIHOh4ic8qdjnHWq9Zi/l0W8Ws4DZ5Y5yI3hBBWGP03W3ggXWdY7MTqVA8plRvaazG/U8CeMPkT5aE.
username emil privilege 15 role network-admin secret sha512 $6$kiCAKn8fb8T12ClP$UchWUxo0y/CpYptWYxj7pC8uzjoUJnvi4lSg1c009mqJG2inlUDQdTi/YVY4M0dzgf4LOkaVtL7U11ZRkP7Rm/
!
vlan 10
   name RED_WEB
!
vlan 11
   name RED_APP
!
vlan 12
   name RED_DB
!
vlan 13
   name RED_STORAGE
!
vlan 20
   name BLUE_WEB
!
vlan 21
   name BLUE_APP
!
vlan 22
   name BLUE_DB
!
vlan 23
   name BLUE_STORAGE
!
vlan 100
   name RED_VMOTION
!
vlan 200
   !! VXLAN
   name BLUE_VMOTION
!
vlan 4093
   name MLAG_PEER_BGP_PEERING
   trunk group MLAG_PEER_BGP
!
vlan 4094
   name MLAG_PEER
   trunk group MLAG_PEER
!
vrf instance BLUE
!
vrf instance MGMT
!
vrf instance RED
!
interface Port-Channel3
   description MLAG PEERLINK TO LEAF1A
   switchport mode trunk
   switchport trunk group MLAG_PEER
   switchport trunk group MLAG_PEER_BGP
!
interface Ethernet1
   description TO SPINE1
   no switchport
   ipv6 enable
   ipv6 address 2001:db8:0:2::2/64
!
interface Ethernet2
   description TO SPINE2
   no switchport
!
interface Ethernet3
   description MLAG PEERLINK TO LEAF1A
   channel-group 3 mode active
!
interface Ethernet4
   description MLAG PEERLINK TO LEAF1A
   channel-group 3 mode active
!
interface Ethernet5
!
interface Ethernet6
!
interface Ethernet7
!
interface Ethernet8
!
interface Loopback0
   description EVPN BGP Peering
   ip address 1.1.1.4/32
!
interface Loopback1
   description VXLAN Tunnel Source
   ip address 11.11.11.1/32
!
interface Management1
   vrf MGMT
   ip address 10.30.30.104/24
!
interface Vlan10
   vrf RED
   ip attached-host route export
   ip address virtual 10.10.0.1/24
!
interface Vlan11
   vrf RED
   ip attached-host route export
   ip address virtual 10.11.0.1/24
!
interface Vlan12
   vrf RED
   ip attached-host route export
   ip address virtual 10.12.0.1/24
!
interface Vlan13
   vrf RED
   ip attached-host route export
   ip address virtual 10.13.0.1/24
!
interface Vlan20
   vrf BLUE
   ip attached-host route export
   ip address virtual 10.20.0.1/24
!
interface Vlan21
   vrf BLUE
   ip address virtual 10.21.0.1/24
!
interface Vlan22
   vrf BLUE
   ip address virtual 10.22.0.1/24
!
interface Vlan23
   vrf BLUE
   ip address virtual 10.23.0.1/24
!
interface Vlan4093
   description MLAG_PEER_BGP_PEERING
   ipv6 enable
   ipv6 address 2001:db8:0:ffff::2/64
!
interface Vlan4094
   description MLAG_PEER
   no autostate
   ip address 172.16.255.1/31
!
interface Vxlan1
   !! BGP/EVPN
   vxlan source-interface Loopback1
   vxlan virtual-router encapsulation mac-address mlag-system-id
   vxlan udp-port 4789
   vxlan vlan 10 vni 10010
   vxlan vlan 11 vni 10011
   vxlan vlan 12 vni 10012
   vxlan vlan 13 vni 10013
   vxlan vlan 20 vni 20020
   vxlan vlan 21 vni 20021
   vxlan vlan 22 vni 20022
   vxlan vlan 23 vni 20023
   vxlan vlan 100 vni 10100
   vxlan vlan 200 vni 20200
   vxlan vrf BLUE vni 50002
   vxlan vrf RED vni 50001
!
ip virtual-router mac-address de:ad:be:ef:ca:fe
!
ip routing ipv6 interfaces 
ip routing vrf BLUE
no ip routing vrf MGMT
ip routing vrf RED
!
ip prefix-list SPINES_OUT_FILTER
   seq 10 permit 1.1.1.0/24 eq 32
   seq 20 permit 11.11.11.0/24 eq 32
!
ipv6 unicast-routing
!
mlag configuration
   domain-id mlagleaf
   local-interface Vlan4094
   peer-address 172.16.255.0
   peer-link Port-Channel3
   dual-primary detection delay 5 action errdisable all-interfaces
   reload-delay mlag 300
   reload-delay non-mlag 330
!
ip route vrf MGMT 0.0.0.0/0 10.30.30.1
!
route-map RM_SPINES_OUT_FILTER permit 10
   match ip address prefix-list SPINES_OUT_FILTER
!
route-map RM_SPINES_OUT_FILTER deny 20
!
router bfd
   multihop interval 1200 min-rx 1200 multiplier 3
!
router bgp 65101
   router-id 1.1.1.4
   no bgp default ipv4-unicast
   distance bgp 20 200 200
   neighbor MLAG_PEER peer group
   neighbor MLAG_PEER remote-as 65101
   neighbor MLAG_PEER next-hop-self
   neighbor MLAG_PEER password 7 uubwnfLNjdAJdu8vwmVOZw==
   neighbor MLAG_PEER send-community
   neighbor MLAG_PEER maximum-routes 0
   neighbor OL_PEERS peer group
   neighbor OL_PEERS remote-as 64512
   neighbor OL_PEERS update-source Loopback0
   neighbor OL_PEERS bfd
   neighbor OL_PEERS ebgp-multihop
   neighbor OL_PEERS password 7 5B04MrjL1a5yKonmJpi1sA==
   neighbor OL_PEERS send-community
   neighbor OL_PEERS maximum-routes 0
   neighbor UL_SPINES peer group
   neighbor UL_SPINES remote-as 64512
   neighbor UL_SPINES route-map RM_SPINES_OUT_FILTER out
   neighbor UL_SPINES password 7 UTX4RwdMksmNiZk1RbtykQ==
   neighbor UL_SPINES send-community
   neighbor UL_SPINES maximum-routes 0
   neighbor 1.1.1.1 peer group OL_PEERS
   neighbor 2001:db8:0:2::1 peer group UL_SPINES
   neighbor 2001:db8:0:ffff::1 peer group MLAG_PEER
   redistribute connected
   !
   vlan-aware-bundle BLUE_VLANS
      rd 1.1.1.4:20
      route-target both 20:20
      redistribute learned
      vlan 20-23,200
   !
   vlan-aware-bundle RED_VLANS
      rd 1.1.1.4:10
      route-target both 10:10
      redistribute learned
      vlan 10-13,100
   !
   address-family evpn
      neighbor OL_PEERS activate
   !
   address-family ipv4
      neighbor MLAG_PEER activate
      neighbor MLAG_PEER next-hop address-family ipv6 originate
      neighbor UL_SPINES activate
      neighbor UL_SPINES next-hop address-family ipv6 originate
   !
   address-family ipv6
      neighbor MLAG_PEER activate
      neighbor UL_SPINES activate
   !
   vrf BLUE
      rd 1.1.1.4:20
      route-target import evpn 20:20
      route-target export evpn 20:20
      redistribute connected
      redistribute attached-host
   !
   vrf RED
      rd 1.1.1.4:10
      route-target import evpn 10:10
      route-target export evpn 10:10
      redistribute connected
      redistribute attached-host
!
management api http-commands
   protocol http
   cors allowed-origin all
   no shutdown
   !
   vrf MGMT
      no shutdown
!
end